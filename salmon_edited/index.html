<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<link href="style/salmon/resetCSS.css" media="all" rel="stylesheet" type="text/css" />
	<link href="style/semantic-0.19.0/packaged/css/semantic.min.css" media="all" rel="stylesheet" type="text/css" />
	<link href="style/textillate/assets/animate.css" media="all" rel="stylesheet" type="text/css" />
	<link href="style/salmon/fixedButton.css" media="all" rel="stylesheet" type="text/css" />
	<link href="style/salmon/style.css" media="all" rel="stylesheet" type="text/css" />

	<script src="style/jquery-1.11.1/jquery-1.11.1.min.js" type="text/javascript"></script>
	<script src="style/semantic-0.19.0/packaged/javascript/semantic.min.js" type="text/javascript"></script>
	<script src="style/textillate/assets/jquery.lettering.js" type="text/javascript"></script>
	<script src="style/textillate/jquery.textillate.js" type="text/javascript"></script>
	<script src="style/salmon/fixedButton.js" type="text/javascript"></script>
</head>
<body>
	<div class="button submitButton">
		<div class="compass"></div>
		<div class="msg">送出報名表</div>
	</div>

	<div class="boxContainer">
		<div class="box first">
			<span class="icon-cont"><i class="circular user icon"></i></span>
			<h3>隊伍隊長</h3>
			<ul class="hidden">
				<li>暱稱</li>
				<li>生日</li>
				<li>電話</li>
				<li>信箱</li>
			</ul>
			<a class="expand"><span class="plus">+</span><span class="minus">-</span></a>
		</div>

		<div class="box second">
			<span class="icon-cont"><i class="circular user icon"></i></span>
			<h3>隊伍隊員一</h3>
			<ul class="hidden">
				<li>暱稱</li>
				<li>生日</li>
				<li>電話</li>
				<li>信箱</li>
			</ul>
			<a class="expand"><span class="plus">+</span><span class="minus">-</span></a>
		</div>

		<div class="box third">
			<span class="icon-cont"><i class="circular user icon"></i></span>
			<h3>隊伍隊員二</h3>
			<ul class="hidden">
				<li>暱稱</li>
				<li>生日</li>
				<li>電話</li>
				<li>信箱</li>
			</ul>
			<a class="expand"><span class="plus">+</span><span class="minus">-</span></a>
		</div>

		<div class="box fourth">
			<span class="icon-cont"><i class="circular user icon"></i></span>
			<h3>隊伍隊員三</h3>
			<ul class="hidden">
				<li>暱稱</li>
				<li>生日</li>
				<li>電話</li>
				<li>信箱</li>
			</ul>
			<a class="expand"><span class="plus">+</span><span class="minus">-</span></a>
		</div>

		<div class="box fifth">
			<span class="icon-cont"><i class="circular user icon"></i></span>
			<h3>隊伍隊員四</h3>
			<ul class="hidden">
				<li>暱稱</li>
				<li>生日</li>
				<li>電話</li>
				<li>信箱</li>
			</ul>
			<a class="expand"><span class="plus">+</span><span class="minus">-</span></a>
		</div>
	</div>

	<div class="registerContainer">
		<div class="registerForm">
			<div class="ui form segment">
				<div class="ui blue message">
					<div class="header">隊長 資料填寫</div>
				</div>

				<div class="center">
					<div class="ui buttons">
						<div class="ui negative button clearMember">清空該成員報名資訊</div>
						<div class="or"></div>
						<div class="ui positive button submitMember">增加該成員報名資訊</div>
					</div>
				</div>

				<div class="ui horizontal icon divider">
					<i class="circular user icon"></i>
				</div>

				<div class="three fields">
					<div class="field">
						<label>您的大名 *</label>
						<input class="submit name" placeholder="Real Name" type="text">
					</div>
					<div class="field">
						<label>名牌暱稱 *</label>
						<input class="submit nickname" placeholder="Nickname" type="text">
					</div>
					<div class="field">
						<label>性別 *</label>
						<div class="ui fluid dropdown selection">
							<input class="submit gender" type="hidden">
							<div class="text">請選擇</div>
							<i class="dropdown icon"></i>
							<div class="menu">
								<div class="item" data-value="1">男性</div>
								<div class="item" data-value="2">女性</div>
							</div>
						</div>
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>身份證字號 *</label>
						<input class="submit roc_id" placeholder="ROC ID" type="text">
					</div>
					<div class="field">
						<label>西元出生日期 *</label>
						<div class="three fields">
							<div class="field">
								<input class="submit born_year" placeholder="Year" type="text">
							</div>
							<div class="field">
								<input class="submit born_month" placeholder="Month" type="text">
							</div>
							<div class="field">
								<input class="submit born_day" placeholder="Day" type="text">
							</div>
						</div>
					</div>
				</div>

				<div class="ui horizontal icon divider">
					<i class="circular phone icon"></i>
				</div>

				<div class="two fields">
					<div class="field">
						<label>聯絡電話 *</label>
						<input class="submit phone" placeholder="Phone" type="text">
					</div>
					<div class="field">
						<label>任職單位／就讀學校系所 *</label>
						<input class="submit department" placeholder="Department" type="text">
					</div>
				</div>
				<div class="two fields">
					<div class="field">
						<label>電子信箱 *</label>
						<input class="submit email" placeholder="Email" type="text">
					</div>
					<div class="field">
						<label>備用電子信箱 *</label>
						<input class="submit email2" placeholder="Second Email" type="text">
					</div>
				</div>

				<div class="ui horizontal icon divider">
					<i class="circular code icon"></i>
				</div>

				<div class="two fields">
					<div class="field">
						<label>是否會任一程式語言 *</label>
						<div class="ui fluid dropdown selection">
							<input class="submit program" type="hidden">
							<div class="text">請選擇</div>
							<i class="dropdown icon"></i>
							<div class="menu">
								<div class="item" data-value="1">會</div>
								<div class="item" data-value="2">不會</div>
							</div>
						</div>
					</div>
				</div>
				<div class="field">
					<label>會使用的語言及專長 *</label>
					<textarea class="submit skills" placeholder="Languages and Skills" type="text"></textarea>
				</div>

				<div class="ui horizontal icon divider">
					<i class="circular food icon"></i>
				</div>

				<div class="two fields">
					<div class="field">
						<label>膳食習慣 *</label>
						<div class="ui fluid dropdown selection">
							<input class="submit food" type="hidden">
							<div class="text">請選擇</div>
							<i class="dropdown icon"></i>
							<div class="menu">
								<div class="item" data-value="1">葷食</div>
								<div class="item" data-value="2">素食</div>
							</div>
						</div>
					</div>
				</div>

				<div class="ui horizontal icon divider">
					<i class="circular ambulance icon"></i>
				</div>

				<div class="two fields">
					<div class="field">
						<label>緊急聯絡人與其關係 *</label>
						<input class="submit emergency" placeholder="Emergency Contact" type="text">
					</div>
					<div class="field">
						<label>緊急聯絡人聯絡方式 *</label>
						<input class="submit emergency_phone" placeholder="Phone" type="text">
					</div>
				</div>
				<div class="field">
					<label>備註</label>
					<textarea class="submit comment" placeholder="Chronic Illness or Helps" type="text"></textarea>
				</div>
			</div>
		</div>
	</div>

	<div class="ui modal">
		<i class="close icon"></i>
		<div class="header">成 員 名 單 最 後 確 認</div>
		<div class="content"></div>
		<div class="actions">
			<div class="ui negative button">取消，回到上一頁</div>
			<div class="ui positive button">確定，送出報名資料</div>
		</div>
	</div>

	<script>
		// First to clear all inputs.
		$('input, textarea').val("");
		$('input, textarea').removeAttr('disabled');
		$('input, textarea').css('cursor', '');

		// Add the box click events.
		$('.box').click(function () {
			$(this).toggleClass('selected');
		});

		// Clone the div container.
		for (var i = 0 ; i < 4 ; i++)
			$($('.registerContainer')[0]).clone().appendTo('body');
		$('.registerContainer').each(function (index) {
			var className = { 1: 'first', 2: 'second', 3: 'third', 4: 'fourth', 5: 'fifth' };
			var titleName = { 1: '隊長 資料填寫', 2: '隊員一 資料填寫', 3: '隊員二 資料填寫', 4: '隊員三 資料填寫', 5: '隊員四 資料填寫' };
			$(this).addClass(className[index+1]);
			$($('.registerContainer .header')[index]).html(titleName[index+1]);
		});

		// Dropdown js.
		$('.ui.dropdown').dropdown();
		$('.ui.dropdown').each(function (index) {
			$(this).click(function () {
				if ($('input', this).val() === '')
					$(this).parent().addClass('error');
			});
		});
		$('.ui.dropdown .menu .item').click(function () {
			$(this).parent().parent().parent().removeClass('error');
		});

		// Add the box click event.
		for (var i in index = { 1: 'first', 2: 'second', 3: 'third', 4: 'fourth', 5: 'fifth' })
			addBoxClickEvent(index[i]);

		function addBoxClickEvent(index) {
			$('.box.' + index).click(function () {
				if ($('.registerContainer.' + index).is(":visible") === false) {
					$('.box').removeClass('selected');
					$(this).addClass('selected');
					$('.registerContainer').hide();
				 	$('.registerContainer.' + index).show();
				 	$('.registerContainer.' + index + ' .ui.message .header').textillate({ in: { effect: 'bounceIn', shuffle: true } });
				}
				else {
					$('.registerContainer').hide();
				}
			});
		}

		// Clear this member.
		$('.clearMember').click(function () {
			var index = $('.registerContainer .clearMember').index(this);
			var boxObject = $($('.boxContainer .box')[index]);
			var listObject = $('ul li', boxObject);
			var inputs = $($('.registerContainer')[index]);
			// All inputs clear in this box.
			$('input', $('.registerContainer')[index]).val('');
			$('.ui.dropdown input', $('.registerContainer')[index]).val('');
			$('.ui.dropdown .text', $('.registerContainer')[index]).html('請選擇');
			// Remove the submit check.
			inputs.removeClass('submitted');
			$('.field.error', inputs).removeClass('error');
			$('input, textarea', inputs).removeAttr('disabled').css('cursor', '');
			$('.ui.blue.button', inputs).removeClass('blue').addClass('positive').html("增加該成員報名資訊");
			// Update the box info.
			$(listObject[0]).html("暱稱");
			$(listObject[1]).html("生日");
			$(listObject[2]).html("電話");
			$(listObject[3]).html("信箱");
			boxObject.css('background-color', 'rgba(0, 0, 0, 0.35)');
		});

		// Submit this member.
		$('.submitMember').click(function () {
			var index = $('.registerContainer .submitMember').index(this);
			var boxObject = $($('.boxContainer .box')[index]);
			var listObject = $('ul li', boxObject);
			var inputs = $($('.registerContainer')[index]);
			immediatelyCheck(index);
			if ($('.field.error', inputs).length === 0) {
				// Add the submit check.
				inputs.addClass('submitted');
				if ($('.ui.positive.button', inputs).length > 0) {
					$('input, textarea', inputs).attr('disabled', 'disabled').css('cursor', 'no-drop');
					$('.ui.positive.button', inputs).removeClass('positive').addClass('blue').html("修改該成員報名資訊");
				}
				else {
					$('input, textarea', inputs).removeAttr('disabled').css('cursor', '');
					$('.ui.blue.button', inputs).removeClass('blue').addClass('positive').html("增加該成員報名資訊");
				}
				// Update the box info.
				$(listObject[0]).html($('input.name', inputs).val());
				$(listObject[1]).html($('input.born_year', inputs).val() + "/" + $('input.born_month', inputs).val() + "/" + $('input.born_day', inputs).val());
				$(listObject[2]).html($('input.phone', inputs).val());
				$(listObject[3]).html($('input.email', inputs).val());
				boxObject.css('background-color', 'rgba(200, 100, 100, 0.85)');
			}

			function immediatelyCheck() {
				formCheckFormat("name", "name", index, true);
				formCheckFormat("nickname", "name", index, true);
				formCheckFormat("roc_id", "roc_id", index, true);
				formCheckFormat("gender", "select2", index, true);
				formCheckFormat("born_year", "year", index, true);
				formCheckFormat("born_month", "month", index, true);
				formCheckFormat("born_day", "day", index, true);
				formCheckFormat("phone", "phone", index, true);
				formCheckFormat("department", "string", index, true);
				formCheckFormat("program", "select2", index, true);
				formCheckFormat("skills", "string", index, true);
				formCheckFormat("email", "email", index, true);
				formCheckFormat("email2", "email", index, true);
				formCheckFormat("food", "select2", index, true);
				formCheckFormat("emergency", "name", index, true);
				formCheckFormat("emergency_phone", "phone", index, true);
			}
		});

		$('.submitButton').click(function () {
			// Hide the others windows.
			$('.box').removeClass('selected');
			$('.registerContainer').hide();
			// Final check.
			if ($('.registerContainer.first.submitted').length > 0 && $('.registerContainer.submitted').length >= 2) {
				$('.ui.modal .content').html("");
				$('.ui.modal .positive').show();
				$('.registerContainer.submitted').each(function (i) {
					var name = $('.submit.name', this).val();
					var nickname = $('.submit.nickname', this).val();
					var gender = $('.submit.gender', this).val();
					var roc_id = $('.submit.roc_id', this).val();
					var born_year = $('.submit.born_year', this).val();
					var born_month = $('.submit.born_month', this).val();
					var born_day = $('.submit.born_day', this).val();
					var phone = $('.submit.phone', this).val();
					var department = $('.submit.department', this).val();
					var program = $('.submit.program', this).val();
					var skills = $('.submit.skills', this).val();
					var email = $('.submit.email', this).val();
					var email2 = $('.submit.email2', this).val();
					var food = $('.submit.food', this).val();
					var emergency = $('.submit.emergency', this).val();
					var emergency_phone = $('.submit.emergency_phone', this).val();
					var comment = $('.submit.comment', this).val();

					var length = $('.registerContainer.submitted').length;
					if (i === 0)
						$('.ui.modal .content').append("<div class='ui top attached segment'><p>隊長：" + name + "（" + email + "）</p></div>");
					else if (i < length - 1)
						$('.ui.modal .content').append("<div class='ui attached segment'><p>隊員：" + name + "（" + email + "）</p></div>");
					else
						$('.ui.modal .content').append("<div class='ui bottom attached segment'><p>隊員：" + name + "（" + email + "）</p></div>");

					console.log(name, nickname, gender, roc_id, born_year, born_month, born_day, phone, department, program, skills, email, email2, emergency, emergency_phone, comment);
				});
			}
			else {
				$('.ui.modal .content').html("團體組：包含隊長必須要有兩名成員報名。");
				$('.ui.modal .positive').hide();
			}
			// Madal open.
			$('.modal').modal('show');
		});

		$(document).ready(function () {
			$('.registerContainer').hide();
		});

		// Format checking.
		formCheckFormat("name", "name");
		formCheckFormat("nickname", "name");
		formCheckFormat("roc_id", "roc_id");
		formCheckFormat("gender", "gender");
		formCheckFormat("born_year", "year");
		formCheckFormat("born_month", "month");
		formCheckFormat("born_day", "day");
		formCheckFormat("phone", "phone");
		formCheckFormat("department", "string");
		formCheckFormat("program", "select2");
		formCheckFormat("skills", "string");
		formCheckFormat("email", "email");
		formCheckFormat("email2", "email");
		formCheckFormat("food", "select2");
		formCheckFormat("emergency", "name");
		formCheckFormat("emergency_phone", "phone");

		function formCheckFormat(objectClassName, type, index, isImmediate) {
			var obj = (index !== undefined) ? $($('.submit.' + objectClassName)[index]) : $('.submit.' + objectClassName);
			obj.each(function (i) {
				// Add the listening input event.
				$(obj[i]).on('input', check);
				$(obj[i]).on('focus', check);
				// When the POST motion end, have to immediate check.
				(isImmediate) ? check() : null;
				if (type === 'name')
					var content = "限 1 ~ 45 中英文字";
				else if (type === 'email')
					var content = "信箱格式，如：sample@mail.com";
				else if (type === 'roc_id')
					var content = "請輸入中華民國身分證字號";
				else if (type === 'phone')
					var content = "請輸入市內電話或手機號碼";
				else if (type === 'string')
					var content = "請輸入內容";
				// $('input.' + objectClassName + ", textarea." + objectClassName).popup({
				// 	on: 'focus',
				// 	position : 'top center',
				// 	content  : content
				// });
				function check() {
					if (type === 'name')
						ifMatch(/^(.|\n){1,45}$/.test($(obj[i]).val()));
					else if (type === 'email')
						ifMatch(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/.test($(obj[i]).val()));
					else if (type === 'roc_id')
						ifMatch(/^[A-Za-z]([0-9]){9}$/.test($(obj[i]).val()));
					else if (type === 'select2')
						ifMatch(/^\d{1}$/.test($(obj[i]).val()) & (($(obj[i]).val() >= 1 && $(obj[i]).val() <= 2) ? true : false));
					else if (type === 'year')
						ifMatch(/^\d{4}$/.test($(obj[i]).val()) & (($(obj[i]).val() >= 1900 && $(obj[i]).val() <= 2010) ? true : false));
					else if (type === 'month')
						ifMatch(/^\d{1,2}$/.test($(obj[i]).val()) & (($(obj[i]).val() >= 1 && $(obj[i]).val() <= 12) ? true : false));
					else if (type === 'day')
						ifMatch(/^\d{1,2}$/.test($(obj[i]).val()) & (($(obj[i]).val() >= 1 && $(obj[i]).val() <= 31) ? true : false));
					else if (type === 'phone')
						ifMatch(/^(.|\n){6,25}$/.test($(obj[i]).val()));
					else if (type === 'string')
						ifMatch(/^(.|\n){1,300}$/.test($(obj[i]).val()));
					function ifMatch(regexResult) {
						// Checking is dropdown or not.
						if ($($(obj[i]).parent()).hasClass('dropdown'))
							regexResult ? $($(obj[i]).parent().parent()).removeClass('error') : $($(obj[i]).parent().parent()).addClass('error');
						else
							regexResult ? $($(obj[i]).parent()).removeClass('error') : $($(obj[i]).parent()).addClass('error');
					}
				}
			});
		}
	</script>
</body>